<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>المصحف الإلكتروني - نسخة الجوال</title>
    <script src="https://unpkg.com/page-flip@2.0.7/dist/js/page-flip.browser.js"></script>
    <style>
        :root { --bg: #121212; --nav: #1f1f1f; --gold: #c4a484; --paper: #f4ece0; }
        body { background: var(--bg); margin: 0; display: flex; flex-direction: column; min-height: 100vh; font-family: 'Segoe UI', sans-serif; overflow: hidden; }

        .navbar {
            width: 100%; background: var(--nav); height: 60px; display: flex;
            justify-content: space-between; align-items: center; padding: 0 10px;
            box-sizing: border-box; box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 1000;
        }

        .info-box { display: flex; flex-direction: column; }
        .surah-label { color: var(--gold); font-size: 16px; font-weight: bold; }
        .page-label { color: #888; font-size: 12px; }

        .controls-nav { display: flex; gap: 8px; align-items: center; }
        .btn-nav { background: #2c2c2c; color: white; border: 1px solid var(--gold); padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 13px; }

        /* منطقة العرض: جعلناها مرنة لتناسب طول الجوال */
        .viewport { flex: 1; display: flex; justify-content: center; align-items: center; padding: 5px; }
        
        /* حاوية الكتاب: عرض كامل للجوال */
        #book-container { width: 100vw; height: 85vh; max-width: 500px; }
        .page { width: 100%; height: 100%; background: var(--paper); display: flex; justify-content: center; align-items: center; }
        .page img { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>

<div class="navbar">
    <div class="info-box">
        <div class="surah-label" id="cur-surah">سورة الفاتحة</div>
        <div class="page-label">صفحة: <span id="cur-page">1</span></div>
    </div>

    <div class="controls-nav">
        <button class="btn-nav" onclick="pageFlip.flipNext()">التالي ←</button>
        <button class="btn-nav" onclick="pageFlip.flipPrev()">→ السابق</button>
    </div>

    <select id="surah-select" onchange="goToPage(this.value)" style="background: #2c2c2c; color: white; border: 1px solid var(--gold); padding: 4px; border-radius: 5px; font-size: 12px;">
        <option value="">الفهرس</option>
    </select>
</div>

<div class="viewport">
    <div id="book-container">
        <div id="quran-book"></div>
    </div>
</div>

<script>
    let pageFlip;
    const surahs = [{name:"الفاتحة", p:1}, {name:"البقرة", p:2}, {name:"آل عمران", p:50}, {name:"النساء", p:77}, {name:"المائدة", p:106}, {name:"الأعراف", p:151}];

    window.onload = function() {
        const book = document.getElementById('quran-book');
        const select = document.getElementById('surah-select');
        
        surahs.forEach(s => { select.add(new Option(s.name, s.p)); });

        for (let i = 1; i <= 605; i++) {
            const page = document.createElement('div');
            page.className = 'page';
            const img = document.createElement('img');
            const pNum = i.toString().padStart(3, '0');
            
            // سيبقى الكود يقرأ من مجلدك المحلي كما فعلت بنجاح
            img.src = pNum + ".jpg"; 
            img.onerror = function() { this.src = "https://raw.githubusercontent.com/search5/quran-images/master/" + pNum + ".jpg"; };
            
            page.appendChild(img);
            book.appendChild(page);
        }

        // الإعدادات السحرية لتحويله إلى صفحة واحدة
        pageFlip = new St.PageFlip(document.getElementById('quran-book'), {
            width: 450, 
            height: 650,
            size: "stretch", 
            showCover: false,   // إلغاء الغلاف لضمان البدء بصفحة واحدة
            usePortrait: true,  // تفعيل الوضع الطولي
            mode: 'portrait',   // إجبار المكتبة على عرض صفحة واحدة فقط
            drawShadow: true,
            mobileScrollSupport: false
        });

        pageFlip.loadFromHTML(document.querySelectorAll('.page'));

        pageFlip.on('flip', (e) => {
            const p = e.data + 1;
            document.getElementById('cur-page').innerText = p;
            let sName = surahs.filter(s => s.p <= p).slice(-1)[0];
            if(sName) document.getElementById('cur-surah').innerText = "سورة " + sName.name;
        });
    };

    function goToPage(p) { if(p) pageFlip.turnToPage(parseInt(p) - 1); }
</script>
</body>
</html>
