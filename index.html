<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>مصحف التلاوة - الثني الناعم</title>
    <style>
        :root { --gold: #b08d57; --black: #1a1a1a; }
        body { background: #f5f5f5; margin: 0; display: flex; flex-direction: column; height: 100vh; font-family: 'Segoe UI', sans-serif; overflow: hidden; }

        header { 
            background: var(--black); padding: 10px 15px; display: flex; 
            justify-content: space-between; align-items: center; 
            border-bottom: 2px solid var(--gold); color: var(--gold); height: 60px; z-index: 100;
        }
        .q-input { background: #fff; border: 1px solid var(--gold); padding: 5px; border-radius: 5px; outline: none; width: 60px; }

        .view-area { 
            flex: 1; display: flex; justify-content: center; align-items: flex-start; 
            padding-top: 15px; perspective: 1000px; 
        }

        .book-container {
            width: 95%; max-width: 450px; height: 80vh;
            position: relative; background: #fff;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden; /* ضروري لقص الورقة المنثنية */
        }

        /* الصفحة الثابتة بالخلف */
        .page-under {
            position: absolute; width: 100%; height: 100%;
            z-index: 1;
        }

        /* الصفحة المتحركة (التي تنثني) */
        .page-top {
            position: absolute; width: 100%; height: 100%;
            z-index: 2; background: white;
            transition: clip-path 0.8s ease-in-out, transform 0.8s ease-in-out;
            transform-origin: left center;
        }

        img { width: 100%; height: 100%; object-fit: contain; }

        /* حركة انثنائية ناعمة (Peel Effect) */
        .peel-animation {
            clip-path: circle(0% at 0% 50%); /* كأن الورقة تُسحب من الزاوية */
            transform: translateX(-20px) scale(0.98);
        }

        /* مناطق اللمس */
        .touch-zone { position: absolute; top: 0; width: 50%; height: 100%; z-index: 50; cursor: pointer; }
        .next-z { left: 0; } .prev-z { right: 0; }
        
        /* تأثير ظل الورقة المنثنية */
        .page-top::after {
            content: ""; position: absolute; top: 0; right: 0; width: 100%; height: 100%;
            background: linear-gradient(to right, rgba(0,0,0,0.1), transparent 20%);
            pointer-events: none;
        }
    </style>
</head>
<body>

<header>
    <div><b id="sName">سورة الفاتحة</b><br><small id="pNumText">صفحة: 1</small></div>
    <div class="search-tools">
        <input type="number" id="pSearch" class="q-input" placeholder="رقم.." oninput="jump(this.value)">
        <select id="sSelect" class="q-input" style="width: auto;" onchange="jump(this.value)"><option value="">السورة..</option></select>
    </div>
</header>

<div class="view-area">
    <div class="book-container">
        <div class="touch-zone next-z" onclick="flip('next')"></div>
        <div class="touch-zone prev-z" onclick="flip('prev')"></div>

        <div class="page-under">
            <img id="imgUnder" src="002.jpg">
        </div>

        <div class="page-top" id="pageTop">
            <img id="imgTop" src="001.jpg">
        </div>
    </div>
</div>

<script>
    let p = parseInt(localStorage.getItem('saved_p')) || 1;
    const surahs = [{n:"الفاتحة",p:1},{n:"البقرة",p:2},{n:"آل عمران",p:50}/*...أضف البقية...*/];

    function updateInfo() {
        document.getElementById('pNumText').innerText = "صفحة: " + p;
        const s = surahs.findLast(x => x.p <= p);
        if(s) document.getElementById('sName').innerText = "سورة " + (s.n || "الفاتحة");
        localStorage.setItem('saved_p', p);
    }

    function flip(dir) {
        const top = document.getElementById('pageTop');
        const imgTop = document.getElementById('imgTop');
        const imgUnder = document.getElementById('imgUnder');

        if (dir === 'next' && p < 604) {
            // تجهيز الصفحة اللي تحت
            imgUnder.src = (p + 1).toString().padStart(3, '0') + ".jpg";
            
            // تشغيل الأنيميشن (الثني الناعم)
            top.classList.add('peel-animation');

            setTimeout(() => {
                p++;
                imgTop.src = p.toString().padStart(3, '0') + ".jpg";
                top.style.transition = "none";
                top.classList.remove('peel-animation');
                updateInfo();
                setTimeout(() => { top.style.transition = "clip-path 0.8s ease-in-out, transform 0.8s ease-in-out"; }, 50);
            }, 800);
        } else if (dir === 'prev' && p > 1) {
            // للرجوع: تظهر الصفحة السابقة من تحت الحالية
            imgUnder.src = p.toString().padStart(3, '0') + ".jpg";
            imgTop.src = (p - 1).toString().padStart(3, '0') + ".jpg";
            top.style.transition = "none";
            top.classList.add('peel-animation');
            
            setTimeout(() => {
                top.style.transition = "clip-path 0.8s ease-in-out, transform 0.8s ease-in-out";
                top.classList.remove('peel-animation');
                p--;
                updateInfo();
            }, 50);
        }
    }

    function jump(v) { if(v >=1 && v <=604) { p = parseInt(v); document.getElementById('imgTop').src = p.toString().padStart(3, '0') + ".jpg"; updateInfo(); } }

    window.onload = () => {
        const sel = document.getElementById('sSelect');
        // هنا تملأ السور برمجياً
        document.getElementById('imgTop').src = p.toString().padStart(3, '0') + ".jpg";
        updateInfo();
    };
</script>
</body>
</html>
