<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>مصحف التلاوة - تقليب كتاب حقيقي</title>
    <style>
        :root { --gold: #b08d57; --black: #1a1a1a; }
        body { background: #f0f0f0; margin: 0; display: flex; flex-direction: column; height: 100vh; font-family: 'Segoe UI', sans-serif; overflow: hidden; }

        header { 
            background: var(--black); padding: 10px 15px; display: flex; 
            justify-content: space-between; align-items: center; 
            border-bottom: 2px solid var(--gold); color: var(--gold); height: 60px; z-index: 100;
        }
        .q-input { background: #fff; border: 1px solid var(--gold); padding: 5px; border-radius: 5px; outline: none; width: 60px; }

        /* منطقة العرض ثلاثية الأبعاد */
        .view-area { 
            flex: 1; display: flex; justify-content: center; align-items: center; 
            perspective: 2000px; background: #e0e0e0; 
        }

        .book {
            width: 90%; max-width: 450px; height: 80vh;
            position: relative; transform-style: preserve-3d;
            background: white; box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }

        /* الصفحات */
        .page {
            position: absolute; width: 100%; height: 100%;
            top: 0; left: 0; pointer-events: none;
            transform-origin: right center; /* محور التقليب من اليمين */
            transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
            background: white;
            display: flex; justify-content: center; align-items: center;
        }

        .page img { width: 100%; height: 100%; object-fit: contain; }

        /* مناطق الضغط */
        .touch-zone {
            position: absolute; top: 0; width: 50%; height: 100%; z-index: 50;
            cursor: pointer; pointer-events: auto;
        }
        .next-z { left: 0; } 
        .prev-z { right: 0; }

        /* الحركة الكبرى للتقليب */
        .flipped { transform: rotateY(180deg); }
    </style>
</head>
<body>

<header>
    <div><b id="sName">سورة الفاتحة</b><br><small id="pNumText">صفحة: 1</small></div>
    <div class="search-tools">
        <input type="number" id="pSearch" class="q-input" placeholder="رقم.." oninput="jump(this.value)">
        <select id="sSelect" class="q-input" style="width: auto;" onchange="jump(this.value)"><option value="">السورة..</option></select>
    </div>
</header>

<div class="view-area">
    <div class="book" id="bookBox">
        <div class="touch-zone next-z" onclick="flipNext()"></div>
        <div class="touch-zone prev-z" onclick="flipPrev()"></div>

        <div class="page" id="backPage">
            <img id="imgBack" src="002.jpg">
        </div>

        <div class="page" id="frontPage">
            <img id="imgFront" src="001.jpg">
        </div>
    </div>
</div>

<script>
    let p = parseInt(localStorage.getItem('saved_p')) || 1;
    const surahs = [{n:"الفاتحة",p:1},{n:"البقرة",p:2},{n:"آل عمران",p:50},{n:"النساء",p:77},{n:"المائدة",p:106},{n:"الأنعام",p:128},{n:"الأعراف",p:151},{n:"الأنفال",p:177},{n:"التوبة",p:187},{n:"يونس",p:208},{n:"هود",p:221},{n:"يوسف",p:235},{n:"الرعد",p:249},{n:"إبراهيم",p:255},{n:"الحجر",p:262},{n:"النحل",p:267},{n:"الإسراء",p:282},{n:"الكهف",p:293},{n:"مريم",p:305},{n:"طه",p:312},{n:"الأنبياء",p:322},{n:"الحج",p:332},{n:"المؤمنون",p:342},{n:"النور",p:350},{n:"الفرقان",p:359},{n:"الشعراء",p:367},{n:"النمل",p:377},{n:"القصص",p:385},{n:"العنكبوت",p:396},{n:"الروم",p:404},{n:"لقمان",p:411},{n:"السجدة",p:415},{n:"الأحزاب",p:418},{n:"سبأ",p:428},{n:"فاطر",p:434},{n:"يس",p:440},{n:"الصافات",p:446},{n:"ص",p:453},{n:"الزمر",p:458},{n:"غافر",p:467},{n:"فصلت",p:477},{n:"الشورى",p:483},{n:"الزخرف",p:489},{n:"الدخان",p:496},{n:"الجاثية",p:499},{n:"الأحقاف",p:502},{n:"محمد",p:507},{n:"الفتح",p:511},{n:"الحجرات",p:515},{n:"ق",p:518},{n:"الذاريات",p:520},{n:"الطور",p:523},{n:"النجم",p:526},{n:"القمر",p:528},{n:"الرحمن",p:531},{n:"الواقعة",p:534},{n:"الحديد",p:537},{n:"المجادلة",p:542},{n:"الحشر",p:545},{n:"الممتحنة",p:549},{n:"الصف",p:551},{n:"الجمعة",p:553},{n:"المنافقون",p:554},{n:"التغابن",p:556},{n:"الطلاق",p:558},{n:"التحريم",p:560},{n:"الملك",p:562},{n:"القلم",p:564},{n:"الحاقة",p:566},{n:"المعارج",p:568},{n:"نوح",p:570},{n:"الجن",p:572},{n:"المزمل",p:574},{n:"المدثر",p:575},{n:"القيامة",p:577},{n:"الإنسان",p:578},{n:"المرسلات",p:580},{n:"النبأ",p:582},{n:"النازعات",p:583},{n:"عبس",p:585},{n:"التكوير",p:586},{n:"الانفطار",p:587},{n:"المطففين",p:587},{n:"الانشقاق",p:589},{n:"البروج",p:590},{n:"الطارق",p:591},{n:"الأعلى",p:591},{n:"الغاشية",p:592},{n:"الفجر",p:593},{n:"البلد",p:594},{n:"الشمس",p:595},{n:"الليل",p:595},{n:"الضحى",p:596},{n:"الشرح",p:596},{n:"التين",p:597},{n:"العلق",p:597},{n:"القدر",p:598},{n:"البينة",p:598},{n:"الزلزلة",p:599},{n:"العاديات",p:599},{n:"القارعة",p:600},{n:"التكاثر",p:600},{n:"العصر",p:601},{n:"الهمزة",p:601},{n:"الفيل",p:601},{n:"قريش",p:602},{n:"الماعون",p:602},{n:"الكوثر",p:602},{n:"الكافرون",p:603},{n:"النصر",p:603},{n:"المسد",p:603},{n:"الإخلاص",p:604},{n:"الفلق",p:604},{n:"الناس",p:604}];

    const frontPage = document.getElementById('frontPage');
    const backPage = document.getElementById('backPage');
    const imgFront = document.getElementById('imgFront');
    const imgBack = document.getElementById('imgBack');

    function updateHeader() {
        document.getElementById('pNumText').innerText = "صفحة: " + p;
        const s = surahs.findLast(x => x.p <= p);
        if(s) document.getElementById('sName').innerText = "سورة " + s.n;
        localStorage.setItem('saved_p', p);
    }

    function flipNext() {
        if (p >= 604) return;
        
        // تجهيز الصورة التالية في الخلفية
        imgBack.src = (p + 1).toString().padStart(3, '0') + ".jpg";
        
        // تنفيذ حركة الطي الكاملة
        frontPage.classList.add('flipped');

        setTimeout(() => {
            p++;
            // بعد انتهاء الحركة، نجعل الصفحة الحالية هي الأمامية ونعيد التموضع
            imgFront.src = p.toString().padStart(3, '0') + ".jpg";
            frontPage.style.transition = "none";
            frontPage.classList.remove('flipped');
            updateHeader();
            // إعادة التفعيل
            setTimeout(() => { frontPage.style.transition = "transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1)"; }, 50);
        }, 800);
    }

    function flipPrev() {
        if (p <= 1) return;
        
        // تجهيز الصفحة السابقة خلف الورقة المنطوية
        imgFront.src = (p - 1).toString().padStart(3, '0') + ".jpg";
        frontPage.style.transition = "none";
        frontPage.classList.add('flipped'); // ابدأ من الوضع المنطوي
        
        setTimeout(() => {
            frontPage.style.transition = "transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1)";
            frontPage.classList.remove('flipped'); // افتح الورقة لليمين
            p--;
            updateHeader();
        }, 50);
    }

    function jump(v) { if(v >=1 && v <=604) { p = parseInt(v); imgFront.src = p.toString().padStart(3, '0') + ".jpg"; updateHeader(); } }

    window.onload = () => {
        const sel = document.getElementById('sSelect');
        surahs.forEach(s => { let opt = document.createElement('option'); opt.value = s.p; opt.text = s.n; sel.add(opt); });
        imgFront.src = p.toString().padStart(3, '0') + ".jpg";
        updateHeader();
    };
</script>
</body>
</html>
